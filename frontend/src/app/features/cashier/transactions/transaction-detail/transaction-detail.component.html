<div class="container-fluid">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-0 fw-bold text-dark">Detail Transaksi</h1>
      <p class="text-muted mb-0" *ngIf="transaction">Transaksi #{{ transaction.id }}</p>
    </div>
    <button class="btn btn-outline-secondary" (click)="onBack()">
      <i class="fas fa-arrow-left me-2"></i>
      Kembali
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-orange" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted mt-2">Memuat detail transaksi...</p>
  </div>

  <!-- Transaction Detail -->
  <div *ngIf="!isLoading && transaction" class="row">
    <!-- Main Details -->
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-orange text-white">
          <h5 class="card-title mb-0">
            <i class="fas fa-receipt me-2"></i>
            Informasi Transaksi #{{ transaction.id }}
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <!-- Client Info -->
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-orange rounded-circle d-flex align-items-center justify-content-center me-3"
                     style="width: 48px; height: 48px;">
                  <i class="fas fa-user text-white"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Nama Client</h6>
                  <h5 class="mb-0">{{ transaction.clientName }}</h5>
                </div>
              </div>
            </div>

            <!-- Date -->
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3"
                     style="width: 48px; height: 48px;">
                  <i class="fas fa-calendar text-white"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Tanggal Transaksi</h6>
                  <h5 class="mb-0">{{ formatDate(transaction.date) }}</h5>
                </div>
              </div>
            </div>

            <!-- Amount -->
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3"
                     style="width: 48px; height: 48px;">
                  <i class="fas fa-money-bill text-white"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Total Jumlah</h6>
                  <h4 class="mb-0 text-success">{{ formatCurrency(transaction.amount) }}</h4>
                </div>
              </div>
            </div>

            <!-- Status -->
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-info rounded-circle d-flex align-items-center justify-content-center me-3"
                     style="width: 48px; height: 48px;">
                  <i class="fas fa-info-circle text-white"></i>
                </div>
                <div>
                  <h6 class="text-muted mb-1">Status</h6>
                  <span [class]="getStatusClass(transaction.status)">
                    {{ getStatusText(transaction.status) }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div class="col-12">
              <div class="border rounded p-3 bg-light">
                <h6 class="text-muted mb-2">
                  <i class="fas fa-clipboard-list me-2"></i>
                  Deskripsi Layanan
                </h6>
                <p class="mb-0 lead">{{ transaction.serviceType }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Panel -->
    <div class="col-lg-4">
      <!-- Status Actions -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
          <h6 class="card-title mb-0">
            <i class="fas fa-cogs me-2 text-orange"></i>
            Aksi Transaksi
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button
              class="btn btn-success"
              (click)="onUpdateStatus('completed')"
              *ngIf="transaction.status !== 'completed'">
              <i class="fas fa-check me-2"></i>
              Tandai Selesai
            </button>

            <button
              class="btn btn-warning"
              (click)="onUpdateStatus('pending')"
              *ngIf="transaction.status !== 'pending'">
              <i class="fas fa-clock me-2"></i>
              Tandai Menunggu
            </button>

            <button
              class="btn btn-danger"
              (click)="onUpdateStatus('cancelled')"
              *ngIf="transaction.status !== 'cancelled'">
              <i class="fas fa-times me-2"></i>
              Batalkan
            </button>

            <hr>

            <button class="btn btn-outline-orange" (click)="onEdit()">
              <i class="fas fa-edit me-2"></i>
              Edit Transaksi
            </button>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h6 class="card-title mb-0">
            <i class="fas fa-history me-2 text-orange"></i>
            Riwayat
          </h6>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker bg-primary"></div>
              <div class="timeline-content">
                <h6 class="mb-1">Transaksi Dibuat</h6>
                <small class="text-muted">{{ formatDateTime(transaction.createdAt) }}</small>
              </div>
            </div>

            <div class="timeline-item" *ngIf="transaction.updatedAt !== transaction.createdAt">
              <div class="timeline-marker bg-info"></div>
              <div class="timeline-content">
                <h6 class="mb-1">Terakhir Diperbarui</h6>
                <small class="text-muted">{{ formatDateTime(transaction.updatedAt) }}</small>
              </div>
            </div>

            <div class="timeline-item" *ngIf="transaction.status === 'completed'">
              <div class="timeline-marker bg-success"></div>
              <div class="timeline-content">
                <h6 class="mb-1">Transaksi Selesai</h6>
                <small class="text-muted">{{ getStatusText(transaction.status) }}</small>
              </div>
            </div>

            <div class="timeline-item" *ngIf="transaction.status === 'cancelled'">
              <div class="timeline-marker bg-danger"></div>
              <div class="timeline-content">
                <h6 class="mb-1">Transaksi Dibatalkan</h6>
                <small class="text-muted">{{ getStatusText(transaction.status) }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Transaction Summary -->
  <div *ngIf="!isLoading && transaction" class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h6 class="card-title mb-0">
            <i class="fas fa-chart-line me-2 text-orange"></i>
            Ringkasan Transaksi
          </h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-3">
              <div class="border-end h-100 d-flex flex-column justify-content-center">
                <h4 class="text-primary mb-1">#{{ transaction.id }}</h4>
                <small class="text-muted">ID Transaksi</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="border-end h-100 d-flex flex-column justify-content-center">
                <h4 class="text-success mb-1">{{ formatCurrency(transaction.amount) }}</h4>
                <small class="text-muted">Total Pembayaran</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="border-end h-100 d-flex flex-column justify-content-center">
                <h4 class="text-info mb-1">{{ transaction.clientName }}</h4>
                <small class="text-muted">Nama Client</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="h-100 d-flex flex-column justify-content-center">
                <span [class]="getStatusClass(transaction.status)" class="mb-1">
                  {{ getStatusText(transaction.status) }}
                </span>
                <small class="text-muted">Status Saat Ini</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
